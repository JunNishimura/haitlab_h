{% extends "recommendation/base.html" %}
{% block content %}

<!-- ユーザーが好きなアニメのタイトルを入力できるページ -->
    <div class="container pt-5">
        <form action="{% url 'candidates' %}" method="POST" id="post-form">
            {% csrf_token %}
            <div class="form-group">
                <label for="animeTitle">Anime Title</label>
                <input type="text" class="form-control" id="animeTitle" placeholder="Anime Title in English" required>
            </div>
            <button type="submit" class="btn btn-secondary">Search</button>
        </form>
    </div>

    <div class="container mt-5">
        <table class="table">
            <thead>
                <th scope="col">#</th>
                <th scope="col">Title</th>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>

    <script>
        $(document).on('submit', '#post-form', function(e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: "{% url 'candidates' %}",
                data: {
                    animeTitle:$('#animeTitle').val(),
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post'
                },
                success:function(json) {
                    document.forms["post-form"].reset();
                    
                    const candidates = json['candidates'];
                    // tableBody下のtrをすべて削除する
                    $('#tableBody').find("tr").remove();
                    // 取得したデータをテーブル形式にしてhtmlに埋め込む
                    for (let i = 0; i < candidates.length; i++) {
                        let trTag = $("<tr />");
                        trTag.append($("<th></th>").text(i+1)).attr("scope", "row");
                        trTag.append($("<td></td>").text(candidates[i]));
                        $("#tableBody").append(trTag);
                    }
                },
                error: function(xhr, errmsg, err) {

                }
            });
        });
    </script>


{% endblock content %}